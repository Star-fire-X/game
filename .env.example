# ============================================================================
# MIR2-CPP 环境配置示例文件
# ============================================================================
# 说明：
# 1. 复制此文件为 .env 并根据实际环境修改配置
# 2. 生产环境请务必修改所有密码和密钥
# 3. 所有配置项都有默认值，可按需调整
# ============================================================================

# ============================================================================
# 通用配置
# ============================================================================

# 环境类型：development(开发) / production(生产) / testing(测试)
ENVIRONMENT=development

# 日志级别：trace / debug / info / warn / error / critical
# 推荐值：开发环境 debug，生产环境 info
LOG_LEVEL=info

# 日志文件最大大小（MB）
# 推荐值：100-500MB，根据磁盘空间调整
LOG_MAX_SIZE_MB=100

# 日志文件保留数量
# 推荐值：5-20个，平衡磁盘空间和历史记录需求
LOG_MAX_FILES=10

# ============================================================================
# PostgreSQL 数据库配置
# ============================================================================

# 数据库主机地址
# Docker 环境使用服务名 'postgres'，本地开发使用 '127.0.0.1'
POSTGRES_HOST=postgres
MIR2_DB_HOST=postgres

# 数据库端口
# 默认：5432
POSTGRES_PORT=5432
MIR2_DB_PORT=5432

# 数据库名称
# 推荐值：mir2 或 mir2_game
POSTGRES_DB=mir2
MIR2_DB_NAME=mir2

# 数据库用户名
# 推荐值：mir2（生产环境建议使用更复杂的用户名）
POSTGRES_USER=mir2
MIR2_DB_USER=mir2

# 数据库密码
# ⚠️ 重要：生产环境必须修改为强密码（建议 16+ 字符，包含大小写字母、数字、特殊字符）
# 生成强密码示例：openssl rand -base64 32
POSTGRES_PASSWORD=mir2_password
MIR2_DB_PASSWORD=mir2_password

# 数据库连接池大小
# 推荐值：根据服务负载调整
#   - 开发环境：5-10
#   - 生产环境：10-50（取决于并发连接数）
POSTGRES_POOL_SIZE=10

# PostgreSQL 数据目录（用于持久化）
# Docker 环境内部路径，通常不需要修改
PGDATA=/var/lib/postgresql/data/pgdata

# ============================================================================
# Redis 缓存配置
# ============================================================================

# Redis 主机地址
# Docker 环境使用服务名 'redis'，本地开发使用 '127.0.0.1'
REDIS_HOST=redis
MIR2_REDIS_HOST=redis

# Redis 端口
# 默认：6379
REDIS_PORT=6379
MIR2_REDIS_PORT=6379

# Redis 密码
# 推荐值：生产环境建议设置强密码
# 留空表示无密码（仅适用于开发环境）
REDIS_PASSWORD=

# Redis 数据库编号
# 推荐值：0-15，可为不同服务分配不同的 DB
REDIS_DB=0

# Redis 持久化模式
# 推荐值：appendonly（AOF 持久化，数据更安全）
REDIS_PERSISTENCE=appendonly

# ============================================================================
# Gateway 服务配置
# ============================================================================

# Gateway 服务 ID
# 推荐值：多网关部署时使用不同 ID（1-255）
GATEWAY_SERVER_ID=1

# Gateway 服务名称
# 推荐值：便于日志识别的名称
GATEWAY_SERVER_NAME=Mir2-Gateway

# Gateway 监听地址
# 推荐值：
#   - 0.0.0.0：监听所有网卡（Docker 环境）
#   - 127.0.0.1：仅本地访问（开发环境）
GATEWAY_BIND_IP=0.0.0.0

# Gateway 客户端连接端口
# 推荐值：7000（游戏客户端连接入口）
GATEWAY_PORT=7000

# Gateway 主机地址（用于其他服务连接）
GATEWAY_HOST=gateway

# Gateway Metrics 监控端口
# 推荐值：9090（用于 Prometheus 监控）
GATEWAY_METRICS_PORT=9090

# Gateway IO 线程数
# 推荐值：根据 CPU 核心数调整
#   - 单核：2
#   - 双核：4
#   - 四核+：4-8
GATEWAY_IO_THREADS=4

# Gateway 最大连接数
# 推荐值：根据预期玩家数量调整
#   - 小型服务器：1000-2000
#   - 中型服务器：5000-10000
#   - 大型服务器：10000+
GATEWAY_MAX_CONNECTIONS=5000

# Gateway 心跳超时时间（毫秒）
# 推荐值：30000-60000ms（30-60秒）
# 超过此时间未收到客户端心跳将断开连接
GATEWAY_HEARTBEAT_TIMEOUT_MS=30000

# Gateway Tick 间隔（毫秒）
# 推荐值：50-100ms（游戏主循环频率）
GATEWAY_TICK_INTERVAL_MS=50

# ============================================================================
# World 服务配置
# ============================================================================

# World 服务 ID
# 推荐值：每个 World 服务唯一 ID
WORLD_SERVER_ID=2

# World 服务名称
WORLD_SERVER_NAME=Mir2-World

# World 监听地址
WORLD_BIND_IP=0.0.0.0

# World 服务端口
# 推荐值：7100（内部服务通信端口）
WORLD_PORT=7100

# World 主机地址（用于其他服务连接）
WORLD_HOST=world

# World Metrics 监控端口
WORLD_METRICS_PORT=9091

# World IO 线程数
# 推荐值：2-4（World 服务计算密集型较少）
WORLD_IO_THREADS=2

# World 最大连接数
# 推荐值：与后端服务数量相关，通常 100-500 即可
WORLD_MAX_CONNECTIONS=1000

# World Tick 间隔（毫秒）
WORLD_TICK_INTERVAL_MS=50

# ECS World Registry 预留实体数
# 推荐值：根据预期在线玩家数设置
#   - 小型：1000
#   - 中型：5000
#   - 大型：10000+
WORLD_REGISTRY_RESERVE=1000

# ============================================================================
# Game 服务配置
# ============================================================================

# Game 服务 ID
# 推荐值：多个 Game 实例使用不同 ID（100-199）
GAME_SERVER_ID=100

# Game 服务名称
GAME_SERVER_NAME=Mir2-Game-1

# Game 监听地址
GAME_BIND_IP=0.0.0.0

# Game 服务端口
# 推荐值：7200-7210（支持多实例）
GAME_PORT=7200

# Game 主机地址（用于其他服务连接）
GAME_HOST=game

# Game Metrics 监控端口
# 推荐值：9100-9110（多实例时依次递增）
GAME_METRICS_PORT=9100

# Game IO 线程数
# 推荐值：根据 CPU 核心数和地图实例数调整
#   - 双核：4
#   - 四核：8
#   - 八核+：8-16
GAME_IO_THREADS=4

# Game 最大连接数
# 推荐值：每个 Game 实例承载的玩家数
#   - 小型：500-1000
#   - 中型：2000-5000
#   - 大型：5000+
GAME_MAX_CONNECTIONS=2000

# Game Tick 间隔（毫秒）
# 推荐值：50ms（保证战斗和移动的流畅性）
GAME_TICK_INTERVAL_MS=50

# Game 实例数量
# 推荐值：根据负载均衡需求设置
#   - 开发环境：1
#   - 生产环境：2-10（根据玩家数量）
GAME_REPLICAS=1

# ============================================================================
# DB 服务配置
# ============================================================================

# DB 服务 ID
DB_SERVER_ID=3

# DB 服务名称
DB_SERVER_NAME=Mir2-DB

# DB 监听地址
DB_BIND_IP=0.0.0.0

# DB 服务端口
# 推荐值：7300（数据库代理服务端口）
DB_PORT=7300

# DB 主机地址（用于其他服务连接）
DB_HOST=db

# DB Metrics 监控端口
DB_METRICS_PORT=9092

# DB IO 线程数
# 推荐值：2-4（数据库访问较多 I/O 等待）
DB_IO_THREADS=2

# DB 最大连接数
# 推荐值：支持所有后端服务连接
DB_MAX_CONNECTIONS=2000

# DB Tick 间隔（毫秒）
DB_TICK_INTERVAL_MS=50

# ============================================================================
# 服务间通信配置
# ============================================================================

# World 服务地址（供其他服务连接）
# Docker 环境：world:7100
# 本地环境：127.0.0.1:7100
MIR2_WORLD_SERVICE=world:7100

# DB 服务地址（供其他服务连接）
# Docker 环境：db:7300
# 本地环境：127.0.0.1:7300
MIR2_DB_SERVICE=db:7300

# Game 服务地址（供 Gateway 负载均衡）
# 多个 Game 实例用逗号分隔
# 示例：game-1:7200,game-2:7201,game-3:7202
MIR2_GAME_SERVICES=game:7200

# ============================================================================
# Docker 资源限制配置
# ============================================================================

# Gateway 资源限制
# 推荐值：Gateway 是网关服务，需要较高性能
GATEWAY_CPU_LIMIT=2
GATEWAY_MEM_LIMIT=1G
GATEWAY_CPU_RESERVATION=1
GATEWAY_MEM_RESERVATION=512M

# World 资源限制
# 推荐值：World 服务处理全局逻辑，中等资源
WORLD_CPU_LIMIT=2
WORLD_MEM_LIMIT=1G
WORLD_CPU_RESERVATION=1
WORLD_MEM_RESERVATION=512M

# Game 资源限制
# 推荐值：Game 服务是主要计算密集型服务，需要最多资源
GAME_CPU_LIMIT=4
GAME_MEM_LIMIT=2G
GAME_CPU_RESERVATION=2
GAME_MEM_RESERVATION=1G

# DB 服务资源限制
# 推荐值：DB 代理服务，轻量级
DB_CPU_LIMIT=1
DB_MEM_LIMIT=512M
DB_CPU_RESERVATION=0.5
DB_MEM_RESERVATION=256M

# PostgreSQL 资源限制
# 推荐值：数据库服务，根据数据量调整
POSTGRES_CPU_LIMIT=2
POSTGRES_MEM_LIMIT=2G
POSTGRES_CPU_RESERVATION=1
POSTGRES_MEM_RESERVATION=1G

# Redis 资源限制
# 推荐值：缓存服务，中等资源
REDIS_CPU_LIMIT=1
REDIS_MEM_LIMIT=512M
REDIS_CPU_RESERVATION=0.5
REDIS_MEM_RESERVATION=256M

# ============================================================================
# Docker 日志配置
# ============================================================================

# 日志驱动
# 推荐值：json-file（Docker 默认）
LOG_DRIVER=json-file

# 单个日志文件最大大小
# 推荐值：10m-50m
LOG_MAX_SIZE=10m

# 日志文件保留数量
# 推荐值：3-10（平衡磁盘空间）
LOG_MAX_FILE=3

# ============================================================================
# 健康检查配置
# ============================================================================

# PostgreSQL 健康检查间隔（秒）
POSTGRES_HEALTHCHECK_INTERVAL=10

# PostgreSQL 健康检查超时（秒）
POSTGRES_HEALTHCHECK_TIMEOUT=5

# PostgreSQL 健康检查重试次数
POSTGRES_HEALTHCHECK_RETRIES=5

# Redis 健康检查间隔（秒）
REDIS_HEALTHCHECK_INTERVAL=10

# Redis 健康检查超时（秒）
REDIS_HEALTHCHECK_TIMEOUT=3

# Redis 健康检查重试次数
REDIS_HEALTHCHECK_RETRIES=5

# ============================================================================
# 网络配置
# ============================================================================

# Docker 网络名称
# 推荐值：mir2-network（所有服务使用同一网络）
NETWORK_NAME=mir2-network

# Docker 网络驱动
# 推荐值：bridge（单机部署）/ overlay（集群部署）
NETWORK_DRIVER=bridge

# ============================================================================
# 持久化存储配置
# ============================================================================

# 数据卷驱动
# 推荐值：local（本地存储）/ nfs（网络存储）
VOLUME_DRIVER=local

# PostgreSQL 数据卷名称
POSTGRES_VOLUME_NAME=postgres_data

# Redis 数据卷名称
REDIS_VOLUME_NAME=redis_data

# 日志卷名称前缀
LOG_VOLUME_PREFIX=mir2

# ============================================================================
# 监控与性能配置
# ============================================================================

# 启用 Prometheus 监控
# 推荐值：true（生产环境建议启用）
ENABLE_METRICS=true

# Prometheus 抓取间隔（秒）
# 推荐值：15-60s
METRICS_SCRAPE_INTERVAL=15

# 启用性能分析
# 推荐值：false（开发调试时启用）
ENABLE_PROFILING=false

# ============================================================================
# 安全配置
# ============================================================================

# JWT 密钥（用于用户认证）
# ⚠️ 重要：生产环境必须使用随机生成的强密钥
# 生成方法：openssl rand -base64 64
JWT_SECRET=your_jwt_secret_key_change_this_in_production

# 会话超时时间（秒）
# 推荐值：3600-86400（1小时-24小时）
SESSION_TIMEOUT=3600

# 启用 SSL/TLS
# 推荐值：生产环境建议启用
ENABLE_SSL=false

# SSL 证书路径（启用 SSL 时需要配置）
SSL_CERT_PATH=/opt/mir2/certs/cert.pem
SSL_KEY_PATH=/opt/mir2/certs/key.pem

# ============================================================================
# 游戏配置参数
# ============================================================================

# 服务器名称（显示给玩家）
SERVER_DISPLAY_NAME=传奇世界

# 服务器版本
SERVER_VERSION=1.0.0

# 最大在线人数
# 推荐值：根据服务器资源设置
MAX_ONLINE_PLAYERS=2000

# 新手保护等级
# 推荐值：1-10
NEWBIE_PROTECTION_LEVEL=10

# 经验倍率
# 推荐值：1.0-10.0
EXP_RATE=1.0

# 掉落倍率
# 推荐值：1.0-10.0
DROP_RATE=1.0

# ============================================================================
# 调试配置（仅开发环境）
# ============================================================================

# 启用调试模式
# ⚠️ 警告：生产环境必须设置为 false
DEBUG_MODE=false

# 启用详细日志
# 推荐值：开发环境 true，生产环境 false
VERBOSE_LOGGING=false

# 启用性能统计
ENABLE_PERFORMANCE_STATS=true

# 启用内存泄漏检测
# 推荐值：仅在调试时启用
ENABLE_MEMORY_LEAK_DETECTION=false

# ============================================================================
# 备份配置
# ============================================================================

# 启用自动备份
ENABLE_AUTO_BACKUP=true

# 备份间隔（小时）
# 推荐值：6-24 小时
BACKUP_INTERVAL_HOURS=24

# 备份保留天数
# 推荐值：7-30 天
BACKUP_RETENTION_DAYS=7

# 备份存储路径
BACKUP_PATH=/opt/mir2/backups

# ============================================================================
# 时区配置
# ============================================================================

# 系统时区
# 推荐值：Asia/Shanghai（中国）/ UTC（国际）
TZ=Asia/Shanghai

# ============================================================================
# 构建配置（用于 Docker 构建）
# ============================================================================

# CMake 构建类型
# 推荐值：Release（生产）/ Debug（调试）
CMAKE_BUILD_TYPE=Release

# 并行编译任务数
# 推荐值：等于 CPU 核心数
BUILD_JOBS=4

# ============================================================================
# 第三方服务配置（可选）
# ============================================================================

# Sentry 错误追踪（可选）
# SENTRY_DSN=https://your-sentry-dsn

# Grafana 监控地址（可选）
# GRAFANA_URL=http://grafana:3000

# 邮件通知配置（可选）
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=noreply@example.com
# SMTP_PASSWORD=your_smtp_password
# SMTP_FROM=noreply@example.com

# ============================================================================
# 开发者备注
# ============================================================================
#
# 配置文件使用指南：
#
# 1. 快速开始（开发环境）：
#    - 复制此文件为 .env
#    - 保持默认配置即可启动
#    - LOG_LEVEL 可改为 debug 查看详细日志
#
# 2. 生产部署：
#    - 必须修改所有密码（POSTGRES_PASSWORD、REDIS_PASSWORD、JWT_SECRET）
#    - 根据服务器配置调整资源限制
#    - 设置 ENVIRONMENT=production
#    - 设置 LOG_LEVEL=info 或 warn
#    - 考虑启用 SSL/TLS
#
# 3. 性能优化：
#    - 根据 CPU 核心数调整 IO_THREADS
#    - 根据内存大小调整 MEM_LIMIT
#    - 根据并发数调整 MAX_CONNECTIONS 和 POOL_SIZE
#    - 监控 Metrics 端口观察性能指标
#
# 4. 扩容策略：
#    - 增加 GAME_REPLICAS 数量横向扩展 Game 服务
#    - 提高资源限制纵向扩展单个服务
#    - 使用 Redis 实现跨服务状态共享
#
# 5. 故障排查：
#    - 检查日志文件：/opt/mir2/logs/
#    - 查看容器日志：docker-compose logs -f [service_name]
#    - 检查健康状态：docker-compose ps
#    - 查看资源使用：docker stats
#
# ============================================================================
